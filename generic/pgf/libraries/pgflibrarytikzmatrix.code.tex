% Copyright 2006 by Till Tantau
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Public License.
%
% See the file doc/generic/pgf/licenses/LICENSE for more details.

\ProvidesFileRCS[v\pgfversion] $Header$


% A matrix of nodes contains a node in each cell.

\tikzstyle{matrix of nodes}=[%
   matrix,%
   cells={anchor=base},%
   nodes={%
     execute at begin node=\strut,%
     execute at end node=,
     name=\tikzmatrixname-\the\pgfmatrixcurrentrow-\the\pgfmatrixcurrentcolumn%
   },
   execute at begin cell=\tikz@lib@matrix@start@cell,%
   execute at end cell=\tikz@lib@matrix@end@cell%
]

\newif\iftikz@lib@matrix@plain

\def\tikz@lib@matrix@start@cell{\pgfutil@ifnextchar\let{\tikz@lib@matrix@check}{\tikz@lib@matrix@plainfalse\node\bgroup}}%

\def\tikz@lib@matrix@check#1{%    
  \pgfutil@ifnextchar\tikz@signal@path{\tikz@lib@matrix@plaintrue\let}{\tikz@lib@matrix@plainfalse\node\bgroup\let}%
}
  
\def\tikz@lib@matrix@end@cell{%
  \iftikz@lib@matrix@plain%
  \else%
    \expandafter\egroup\expandafter;%
  \fi%    
}


% Same as a matrix of nodes, but switch on math mode in each cell
\tikzstyle{matrix of math nodes}=[%
  matrix of nodes,
  nodes={%
   execute at begin node=$\mathstrut,%
   execute at end node=$%
  }%
]



% Provide a delimiter

\tikzoption{left delimiter}{\tikz@add@after@node@path{\tikz@delimiter%
    {south east}%
    {south west}%
    {}%
    {south}%
    {north}%
    {#1}%
    {.}%
    {\pgf@y}}}

\tikzoption{right delimiter}{\tikz@add@after@node@path{\tikz@delimiter%
    {south west}%
    {south east}%
    {}%
    {south}%
    {north}%
    {.}%
    {#1}%
    {\pgf@y}}}

\tikzoption{above delimiter}{\tikz@add@after@node@path{\tikz@delimiter%
    {south east}%
    {north west}%
    {rotate=-90}%
    {west}%
    {east}%
    {#1}%
    {.}%
    {\pgf@x}}}

\tikzoption{below delimiter}{\tikz@add@after@node@path{\tikz@delimiter%
    {south west}%
    {south west}%
    {rotate=-90}%
    {west}%
    {east}%
    {.}%
    {#1}%
    {\pgf@x}}}

\def\tikz@delimiter#1#2#3#4#5#6#7#8{%
  \bgroup
    \pgfextra{\let\tikz@save@last@fig@name=\tikz@last@fig@name}%
    node[outer sep=0pt,inner sep=0pt,draw=none,fill=none,anchor=#1,at=(\tikz@last@fig@name.#2),#3]
    {%
      {\nullfont\pgf@process{\pgfpointdiff{\pgfpointanchor{\tikz@last@fig@name}{#4}}{\pgfpointanchor{\tikz@last@fig@name}{#5}}}}%
      $\left#6\vcenter{\hrule height .5#8 depth .5#8 width0pt}\right#7$%
    }
    \pgfextra{\global\let\tikz@last@fig@name=\tikz@save@last@fig@name}%
  \egroup%
}

\endinput
