% Copyright 2008 by Till Tantau
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Public License.
%
% See the file doc/generic/pgf/licenses/LICENSE for more details.

\ProvidesFileRCS[v\pgfversion] $Header$

\usepgfmodule{datavisualization}


\tikzset{/tikz/data visualization/.is family,
  /tikz/data visualization/.unknown/.code={
    \let\tikz@dv@key\pgfkeyscurrentname% 
    \pgfkeys{/tikz/\tikz@dv@key/.try={#1}}%
    \ifpgfkeyssuccess%
    \else%
      \pgfkeys{/errors/unknown key={/tikz/data visualization/\tikz@dv@key}{#1}}%
    \fi%
  },
  /tikz/data visualization/data/.unknown/.code={%
    % Redirect to /pgf/data
    \let\tikz@dv@key\pgfkeyscurrentname% 
    \pgfkeys{/pgf/data/\tikz@dv@key/.try={#1}}%
    \ifpgfkeyssuccess%
    \else%
      \pgfkeys{/errors/unknown key={/pgf/data/\tikz@dv@key}{#1}}%
    \fi%
  }
}

\def\tikzdatavisualizationset{\pgfqkeys{/tikz/data visualization}}




% The main \datavisualization command
%
% This command must, as always, be given inside a tikz picture. It
% will add a data visualization to the picture; use "shift" option and
% friends to place the data visualization somewhere other than at the
% origin.
%
% The \datavisualization is followed by a sequence of blocks and ended
% with a semicolon. Each block may be one of the following:
%
% "data" blocks.
%
%   Syntax: data [options]                  % options specify an external source
%   Syntax: data [options] { inline data }  
%
%   The optional arguments may either specify an
%   external data source or the data may follow inline.
%
%   The options are executed for the path /pgf/data. The style
%   /tikz/every data is executed for each data, which can be useful to
%   generally set, say, a certain data format.
%
% "infos" blocks.
%
%   Syntax: infos [options] {code}
%
%   A block starting with "infos" may contain any code. It
%   will be executed after the visualization. In order to execute code
%   at some other time (like, say, before the visualization), use
%   options like "before visualization".
%
% Options blocks.
%
%   Syntax: [options]
%
%   The options will be executed immediately.
%
% Scope blocks.
%
%   Syntax: scope[options] { blocks }
%
%   The blocks are executed inside a scope for which the options are
%   set. This can be used to group data blocks.
%
% Examples:
%
% \datavisualization[schoolbook plot]
%   data [source=my_data_file.csv]
% ;
%
%  \datavisualization[schoolbook plot]
%    data [format=key value pairs]
%    {
%      x=0, y=0
%      x=1, y=1
%      x=2, y=4
%      x=3, y=9
%    };
%
%  \datavisualization[schoolbook plot]
%    data [format=function]
%    {
%      var x: interval [0:3];
%      func y = \value x*\value x;
%    }
%    [before visualization={
%      \fill [black!10] (visualization cs:x=0,y=0) -- (visualization cs:x=3,y=9);
%    }]
%    infos[red]
%    {
%      \draw (visualization cs:x=0,y=0) -- (visualization cs:x=3,y=9);
%    };
%
%  \datavisualization[schoolbook plot]
%    data [/data point/label=first experiment,source=file_1]
%    data [/data point/label=second experiment,source=file_2]
%    data [/data point/label=third experiment,source=file_3]
%    data [/data point/label=prediction,format=function]
%      { var x: interval [0,1]; func y = rand(\value x); }
%    ;

\def\tikz@lib@datavisualization{
  \begingroup%
    % Ok, first, start a new data visualization
    \pgfoonew \tikz@main@dv=new data visualization()%
    % Next, create a scope for the dv
    \pgfset{local bounding box=data visualization bounding box}%
    % Clear the axis list
    \pgfkeyslet{/tikz/data visualization/axes list}\pgfutil@empty%
    \pgfkeyslet{/tikz/data visualization/axes actions}\pgfutil@empty%
    \pgfkeyslet{/tikz/data visualization/label actions}\pgfutil@empty%
    \pgfkeyslet{/tikz/data visualization/major grid actions}\pgfutil@empty%
    \pgfkeyslet{/tikz/data visualization/minor grid actions}\pgfutil@empty%
    \pgfkeyslet{/tikz/data visualization/subminor grid actions}\pgfutil@empty%
    \pgfkeyslet{/tikz/data visualization/major ticks actions}\pgfutil@empty%
    \pgfkeyslet{/tikz/data visualization/minor ticks actions}\pgfutil@empty%
    \pgfkeyslet{/tikz/data visualization/subminor ticks actions}\pgfutil@empty%
    \tikz@main@dv.before visualization(%
      \pgfkeysvalueof{/tikz/data visualization/subminor grid actions}
      \pgfkeysvalueof{/tikz/data visualization/minor grid actions}
      \pgfkeysvalueof{/tikz/data visualization/major grid actions}
      \pgfkeysvalueof{/tikz/data visualization/axes actions}
    )%
    \tikz@main@dv.after visualization(%
      \pgfkeysvalueof{/tikz/data visualization/subminor ticks actions}
      \pgfkeysvalueof{/tikz/data visualization/minor ticks actions}
      \pgfkeysvalueof{/tikz/data visualization/major ticks actions}
      \pgfkeysvalueof{/tikz/data visualization/label actions}
    )%
    %
    \pgfset{/pgf/data/continue code=\tikz@lib@dv@parse@loop}%
    % Now enter parse loop
    \tikz@lib@dv@parse@loop
}

\def\tikz@lib@dv@parse@loop{%  
  \pgfutil@ifnextchar d\tikz@lib@dv@handle@data{%
    \pgfutil@ifnextchar ;\tikz@lib@dv@parse@end{%
      \pgfutil@ifnextchar \par\tikz@lib@dv@handle@par{%
        \pgfutil@ifnextchar s\tikz@lib@dv@handle@beginscope{%
          \pgfutil@ifnextchar i\tikz@lib@dv@handle@info{%
            \pgfutil@ifnextchar [\tikz@lib@dv@handle@options{%
              \pgfutil@ifnextchar \egroup\tikz@lib@dv@handle@endscope{%
                \PackageError{tikz}{Semicolon expected}{}%
                \endgroup%
              }%
            }%
          }%
        }%
      }%
    }%
  }%
}
\def\tikz@lib@dv@parse@end{%
    % Go!
    \tikz@main@dv.survey()%
    \tikz@main@dv.visualize()%
  \endgroup%
}
\def\tikz@lib@dv@handle@par\par{\tikz@lib@dv@parse@loop}

\def\tikz@lib@dv@handle@options[#1]{%
  \tikzdatavisualizationset{#1}%
  \tikz@lib@dv@parse@loop%
}

\def\tikz@lib@dv@handle@beginscope scope{%
  \begingroup%
    \pgfutil@ifnextchar[\tikz@lib@dv@beg@opt{\tikz@lib@dv@beg@opt[]}%}
}
\def\tikz@lib@dv@beg@opt[#1]{%
  \pgfkeys{/pgf/data/.cd,/pgf/every data/.try,#1}%
  \pgfkeysvalueof{/pgf/data visualization/obj}.add data({{\begingroup\pgfkeys{/pgf/data/.cd,/pgf/every data/.try,#1}}})%
  \pgfutil@ifnextchar\bgroup{
    \afterassignment\tikz@lib@dv@parse@loop%
    \let\tikz@dummy=%get rid of \bgroup
  }{%
    \PackageError{pgf}{Opening brace expected}{}%
  }%
}
\def\tikz@lib@dv@handle@endscope{%
    \pgfkeysvalueof{/pgf/data visualization/obj}.add data(\endgroup)%
  \endgroup%
  \afterassignment\tikz@lib@dv@parse@loop%
  \let\tikz@dummy=%get rid of \egroup
}

\def\tikz@lib@dv@handle@data data{\pgfdata}

\def\tikz@lib@dv@handle@info infos{
  \pgfutil@ifnextchar[{\tikz@lib@dv@handle@info@block@opt}{\tikz@lib@dv@handle@info@block@opt[]}}%}
\def\tikz@lib@dv@handle@info@block@opt[#1]#2{%
  \tikz@main@dv.after visualization({{\scope[#1]#2\endscope}})%
  \tikz@lib@dv@parse@loop
}


\pgfset{/pgf/every data/.style={/tikz/every data/.try,/tikz/data visualization/every data/.try}}


%
% Performing before/after stuff via keys
% 

\tikzdatavisualizationset{
  before survey/.code=\tikz@main@dv.before survey({{#1}}),
  after survey/.code=\tikz@main@dv.after survey({{#1}}),
  before visualization/.code=\tikz@main@dv.before visualization({{#1}}),
  after visualization/.code=\tikz@main@dv.after visualization({{#1}}),
  at start survey/.code=\tikz@main@dv.at start survey({{#1}}),
  at end survey/.code=\tikz@main@dv.at end survey({{#1}}),
  at start visualization/.code=\tikz@main@dv.at start visualization({{#1}}),
  at end visualization/.code=\tikz@main@dv.at end visualization({{#1}}),
}



%
% Object setup 
%

% The following key is used to create objects for the rendering
% pipeline. They cannot be created "directly" because when it is known
% that the objects needs to be created, in principle, many keys may
% not yet be known.
%
% The following options are used:
%
% store           = key that will store the object (handle)
% class           = class of the object
% arg1            = argument1 of the constructor
% ...
% arg8            = argument8 of the constructor
% when            = specifies when the object will be created. Defaults to
%                   "before survey", other possible values are "after survey" and
%                   "before/after visualization"
% before creation = code to be executed just before the object is
%                   created
% after creation  = code to be executed just after the object has been created
%
% The following styles may be useful:
%
% arg1 from key        = use the contents of the given key as arg1. Similar
%                        for other args          
% arg1 handle from key = the contents of the given key should contain
%                        an object. Then arg1 will be a handle to this
%                        object. Similar for other args          

\tikzdatavisualizationset{%
  new object/.code={%
    \def\tikz@dv@grabbed@when{before survey}%
    \let\tikz@dv@grabbed@store\pgfutil@empty
    \pgfkeys{/tikz/data visualization/new object/grab/.cd,#1}%
    \ifx\tikz@dv@grabbed@store\pgfutil@empty
      \PackageError{tikz}{Internal error: new object must be stored to
        avoid duplicated on repeated styles}{}
    \else
      \pgfkeyslet{\tikz@dv@grabbed@store}\pgfutil@empty%
    \fi
    \edef\tikz@marshal{\noexpand\tikz@main@dv.\tikz@dv@grabbed@when(\noexpand\tikz@dv@newobject{\tikz@dv@grabbed@store}}%
    \tikz@marshal{#1})%
  },
  new object/grab/store/.store in=\tikz@dv@grabbed@store,
  new object/grab/when/.store in=\tikz@dv@grabbed@when,
  new object/grab/.unknown/.code={},%ignore
}

\def\tikz@dv@newobject#1#2{%
  \pgfkeysgetvalue{#1}\tikz@dv@temp
  \ifx\tikz@dv@temp\pgfutil@empty
    \let\tikz@dv@arg@a=\tikz@lib@notused%
    \let\tikz@dv@arg@b=\tikz@lib@notused%
    \let\tikz@dv@arg@c=\tikz@lib@notused%
    \let\tikz@dv@arg@d=\tikz@lib@notused%
    \let\tikz@dv@arg@e=\tikz@lib@notused%
    \let\tikz@dv@arg@f=\tikz@lib@notused%
    \let\tikz@dv@arg@g=\tikz@lib@notused%
    \let\tikz@dv@arg@h=\tikz@lib@notused%
    \let\tikz@dv@new@after=\relax%
    \pgfkeys{/tikz/data visualization/new object/parse/.cd,#2}
    \edef\pgf@marshal{\noexpand\pgfoonew\noexpand\tikzdvobj=new \tikz@dv@new@class(}%
    \tikz@dv@add@arg{}\tikz@dv@arg@a%
    \tikz@dv@add@arg{\expandafter,}\tikz@dv@arg@b%
    \tikz@dv@add@arg{\expandafter,}\tikz@dv@arg@c%
    \tikz@dv@add@arg{\expandafter,}\tikz@dv@arg@d%
    \tikz@dv@add@arg{\expandafter,}\tikz@dv@arg@e%
    \tikz@dv@add@arg{\expandafter,}\tikz@dv@arg@f%
    \tikz@dv@add@arg{\expandafter,}\tikz@dv@arg@g%
    \tikz@dv@add@arg{\expandafter,}\tikz@dv@arg@h%
    \expandafter\def\expandafter\pgf@marshal\expandafter{\pgf@marshal)}%
    \pgf@marshal%
    \tikzdvobj.default connects()%
    \pgfkeyslet{#1}\tikzdvobj%
    \tikz@dv@new@after%
  \fi
}       
\def\tikz@lib@notused{\tikz@lib@notused}

\def\tikz@dv@add@arg#1#2{%
  \ifx#2\tikz@lib@notused%
  \else%
    \expandafter\expandafter\expandafter\def%
    \expandafter\expandafter\expandafter\pgf@marshal%
    \expandafter\expandafter\expandafter{\expandafter\pgf@marshal#1#2}%
  \fi%
}

\tikzdatavisualizationset{%
  new object/parse/.cd,
  store/.code=,% ignore
  when/.code=,% ignore
  class/.store in=\tikz@dv@new@class,
  before creation/.code=#1,
  after creation/.store in=\tikz@dv@new@after,
  arg1/.store in=\tikz@dv@arg@a,
  arg2/.store in=\tikz@dv@arg@b,
  arg3/.store in=\tikz@dv@arg@c,
  arg4/.store in=\tikz@dv@arg@d,
  arg5/.store in=\tikz@dv@arg@e,
  arg6/.store in=\tikz@dv@arg@f,
  arg7/.store in=\tikz@dv@arg@g,
  arg8/.store in=\tikz@dv@arg@h,
  arg1 from key/.code=\pgfkeysgetvalue{#1}{\tikz@dv@arg@a},
  arg2 from key/.code=\pgfkeysgetvalue{#1}{\tikz@dv@arg@b},
  arg3 from key/.code=\pgfkeysgetvalue{#1}{\tikz@dv@arg@c},
  arg4 from key/.code=\pgfkeysgetvalue{#1}{\tikz@dv@arg@d},
  arg5 from key/.code=\pgfkeysgetvalue{#1}{\tikz@dv@arg@e},
  arg6 from key/.code=\pgfkeysgetvalue{#1}{\tikz@dv@arg@f},
  arg7 from key/.code=\pgfkeysgetvalue{#1}{\tikz@dv@arg@g},
  arg8 from key/.code=\pgfkeysgetvalue{#1}{\tikz@dv@arg@h}
  arg1 handle from key/.code=\tikz@dv@handle@from@key{#1}{\tikz@dv@handle@a}{\tikz@dv@arg@a},
  arg2 handle from key/.code=\tikz@dv@handle@from@key{#1}{\tikz@dv@handle@b}{\tikz@dv@arg@b},
  arg3 handle from key/.code=\tikz@dv@handle@from@key{#1}{\tikz@dv@handle@c}{\tikz@dv@arg@c},
  arg4 handle from key/.code=\tikz@dv@handle@from@key{#1}{\tikz@dv@handle@d}{\tikz@dv@arg@d},
  arg5 handle from key/.code=\tikz@dv@handle@from@key{#1}{\tikz@dv@handle@e}{\tikz@dv@arg@e},
  arg6 handle from key/.code=\tikz@dv@handle@from@key{#1}{\tikz@dv@handle@f}{\tikz@dv@arg@f},
  arg7 handle from key/.code=\tikz@dv@handle@from@key{#1}{\tikz@dv@handle@g}{\tikz@dv@arg@g},
  arg8 handle from key/.code=\tikz@dv@handle@from@key{#1}{\tikz@dv@handle@h}{\tikz@dv@arg@h}
}

\def\tikz@dv@handle@from@key#1#2#3{%
  \pgfkeysvalueof{#1}.get handle(#2)%
  \def#3{#2}%
}




%
% Data visualization coordinate system
%
%
% This cs is used to refer to points in a datavisualization. The
% parameters are keys that are set in the /data point key
% directory. Then, a (virtual) data point is created and the
% calculated position is returned

\tikzdeclarecoordinatesystem{visualization}
{%
  \tikzset{/data point/.cd,#1}%
  \pgfcanvaspositionofvirtualdatapoint%
}




%
%
% Axes
%
%



%
% Axis base
%

\tikzdatavisualizationset{%
  new axis/.style={
    new object={
      class=scaling mapper,
      store=/tikz/data visualization/#1/scaling mapper,
      before creation={
        \pgfkeysgetvalue{/tikz/data visualization/#1/scaling}\tikz@temp
        \ifx\tikz@temp\pgfutil@empty%
          \pgfkeysgetvalue{/tikz/data visualization/#1/scaling/default}\tikz@temp
          \pgfkeyslet{/tikz/data visualization/#1/scaling}\tikz@temp
        \fi
      },
      arg1 from key=/tikz/data visualization/#1/attribute,
      arg2/.expanded=\pgfkeysvalueof{/tikz/data visualization/#1/attribute}/scaled,
      arg3 from key=/tikz/data visualization/#1/scaling,
      arg4 from key=/tikz/data visualization/#1/function
    },
    #1/attribute/.initial=#1,
    #1/function/.initial=,
    #1/scaling/.initial=,
    #1/scaling/default/.initial=0 at 0 and 1 at 1,
    #1/ticks at/.initial=,
    #1/major ticks/.initial=,
    #1/minor ticks/.initial=,
    #1/subminor ticks/.initial=,
    #1/grid at/.initial=,
    #1/major grid/.initial=,
    #1/minor grid/.initial=,
    #1/subminor grid/.initial=,
    #1/label/.initial=,
    #1/min extend/.initial=0pt,
    #1/max extend/.initial=0pt,
    #1/.code={
      \let\tikz@temp\tikz@dv@axis%
      \def\tikz@dv@axis{/tikz/data visualization/#1}%
      \expandafter\tikz@do@axis@options\expandafter{\tikz@temp}{##1}%
    },
    axes list/.append={\tikz@lib@dv@do@axis{#1}}
  },
  all axes/.code={
    \def\tikz@lib@dv@args{#1}%
    \pgfkeysvalueof{/tikz/data visualization/axes list}%
  },
  % General styling
  styling/.style=,
  style/.style={styling/.append style={#1}},
  node styling/.style=,
  node style/.style={node styling/.append style={#1}},
  grid styling/.style=,
  grid style/.style={grid styling/.append style={#1}},
  % General extends (both axis and ticks)
  min extend/.initial=0pt,
  max extend/.initial=0pt,
  % General tick and grid keys:
  common/.initial=,
  common/.code={\pgfkeysaddvalue{/tikz/data visualization/common}{}{,#1}},
  major/.initial=,
  major/.code=\tikz@lib@dv@add@major{#1},
  minor/.initial=,
  minor/.code=\tikz@lib@dv@add@minor{#1},
  subminor/.initial=,
  subminor/.code=\tikz@lib@dv@add@subminor{#1},
  % Tick keys
  direction axis/.initial=,
  value/.initial=,
  pos/.initial=,
  tick text at min extend/.is if=tikz@dv@min@tick@node,
  tick text at max extend/.is if=tikz@dv@max@tick@node,
  no tick text/.style={tick text at min extend=false,tick text at max extend=false},
  every major ticks/.style={style={line cap=round},min extend=-2pt,max extend=2pt},
  every minor ticks/.style={style={help lines,thin,line cap=round},min extend=-1.4pt,max extend=1.4pt},
  every subminor ticks/.style={style={help lines,line cap=round},min extend=-0.8pt,max extend=0.8pt},
  clean ticks/.style={node style={fill=white}},
  % Default grid styles
  grid style={max extend=max,min extend=min},
  every major grid/.style={style={help lines,thin,black!25}},
  every minor grid/.style={style={help lines,black!25}},
  every subminor grid/.style={style={help lines,black!10}}
}

\def\tikz@lib@dv@add@major#1{\pgfkeysaddvalue{/tikz/data visualization/major}{}{,#1}}
\def\tikz@lib@dv@add@minor#1{\pgfkeysaddvalue{/tikz/data visualization/minor}{}{,#1}}
\def\tikz@lib@dv@add@subminor#1{\pgfkeysaddvalue{/tikz/data visualization/subminor}{}{,#1}}

% Ticks at
\tikzdatavisualizationset{
  at/.code={\def\tikz@dv@at@list{#1}},
  also at/.code={\expandafter\def\expandafter\tikz@dv@at@list\expandafter{\tikz@dv@at@list,#1}},
}


\def\tikz@lib@dv@do@axis#1{%
  \def\tikz@marshal{#1=}
  \expandafter\expandafter\expandafter\tikzdatavisualizationset%
  \expandafter\expandafter\expandafter{\expandafter\tikz@marshal\expandafter{\tikz@lib@dv@args}}
}

\def\tikz@do@axis@options#1#2{
  \pgfkeys{/tikz/data visualization/axis options/.cd,#2}
  \def\tikz@dv@axis{#1}
}
\let\tikz@dv@axis\pgfutil@empty

\tikzdatavisualizationset{
  every ticks/.style={
    node style={%
      font=\pgfutil@font@footnotesize,
      inner sep=1pt,
      outer sep=.1666em,
      rounded corners=1.5pt
    }
  },
  every label/.style={
    node style={%
      font=\pgfutil@font@small
    }
  }  
}

\tikzset{
  /tikz/data visualization/axis options/.cd,
  %
  % Basic setters
  %
  attribute/.style={\tikz@dv@axis/attribute={#1}},
  function/.style={\tikz@dv@axis/function={#1}},
  scaling/.style={\tikz@dv@axis/scaling={#1}},
  log axis/.style={
    \tikz@dv@axis/function=\pgfmathparse{ln(\pgfvalue)},
    \tikz@dv@axis/scaling/default=1 at 0 and 10 at 1
  },
  min extend/.style={\tikz@dv@axis/min extend={#1}},
  max extend/.style={\tikz@dv@axis/max extend={#1}},
  label/.style={\tikz@dv@axis/label={#1}},
  %
  % Attribute setter
  %
  goto/.code={\pgfkeysvalueof{\tikz@dv@axis/scaling mapper}.set in to(#1)},
  %
  % Visualization setters
  %
  visualize axis/.code=\expandafter\tikz@lib@dv@av\expandafter{\tikz@dv@axis}{#1},
  %
  % Ticks settings
  %
  ticks/.style={\tikz@dv@axis/ticks at/.append={,#1}},
  major ticks at/.style={ticks={major={at={#1}}}},
  minor ticks at/.style={ticks={minor={at={#1}}}},
  subminor ticks at/.style={ticks={subminor={at={#1}}}},
  visualize ticks/.code=\expandafter\tikz@lib@dv@tv\expandafter{\tikz@dv@axis}{#1},
  %
  % Grid settings
  %
  grid/.style={\tikz@dv@axis/grid at/.append={,#1}},
  major grid at/.style={grid={major={at={#1}}}},
  minor grid at/.style={grid={minor={at={#1}}}},
  subminor grid at/.style={grid={subminor={at={#1}}}},
  visualize grid/.code=\expandafter\tikz@lib@dv@gv\expandafter{\tikz@dv@axis}{#1},
  % 
  % Visualizing axis labels
  % 
  visualize label/.code=\expandafter\tikz@lib@dv@lv\expandafter{\tikz@dv@axis}{#1},
}


% Axis visualization
%
% #1 = name of the to-be-visualized axis name
% #2 = options for the visualization

\def\tikz@lib@dv@av#1#2{
  \tikzdatavisualizationset{
    axes actions/.append={\tikz@lib@dv@show@axis{#1}{#2}}
  }
}

\def\tikz@lib@dv@show@axis#1#2{%
  \scope[/tikz/data visualization/.cd,every axis/.try,#2]
    \pgfkeysgetvalue{#1/scaling mapper}\tikz@dv@axis@mapper
    % Ok, calculate direction vector:
    \tikzpointandanchordirection{\tikz@dv@axis@mapper.set in to(min)}{\tikz@dv@axis@mapper.set in to(max)}
    \xdef\tikz@dv@axis@dir{\noexpand\pgfqpoint{\the\pgf@x}{\the\pgf@y}}
    \path[draw,/tikz/data visualization/styling]
    \pgfextra{
      {
        \pgftransformshift{\pgfpointscale{\pgfkeysvalueof{#1/min extend}}{\tikz@dv@axis@dir}}
        \pgfkeysvalueof{#1/scaling mapper}.set in to(min)
        \pgfpathdvmoveto%
      }
      {
        \pgftransformshift{\pgfpointscale{\pgfkeysvalueof{#1/max extend}}{\tikz@dv@axis@dir}}
        \pgfkeysvalueof{#1/scaling mapper}.set in to(max)
        \pgfpathdvlineto%
      }
    };
  \endscope
}



% Ticks visualization 
%
% #1 = name of axis on which ticks should be shown
% #2 = options for the visualization

\def\tikz@lib@dv@tv#1#2{
  \tikzdatavisualizationset{
    major ticks actions/.append={\tikz@lib@dv@show@ticks{major}{#1}{#2}},
    minor ticks actions/.append={\tikz@lib@dv@show@ticks{minor}{#1}{#2}},
    subminor ticks actions/.append={\tikz@lib@dv@show@ticks{subminor}{#1}{#2}}
  }
}



\def\tikz@lib@dv@show@ticks#1#2#3{%
  % First, check whether there is anything to do at all:
  \pgfkeysgetvalue{#2/ticks at}\tikz@lib@dv@settings%
  \ifx\tikz@lib@dv@settings\pgfutil@empty%
    % Great, nothing to do
  \else
    {%
      \let\tikz@dv@at@list\pgfutil@empty%
      \scope[/tikz/data visualization/.cd,every ticks/.try,every #1 ticks/.try,#3]%
        % Setup options
        \pgfkeysgetvalue{#2/scaling mapper}\tikz@lib@dv@mapper
        \expandafter\tikzdatavisualizationset\expandafter{\tikz@lib@dv@settings}%
        \pgfkeysgetvalue{/tikz/data visualization/common}\tikz@temp
        \expandafter\tikzdatavisualizationset\expandafter{\tikz@temp}
        \pgfkeysgetvalue{/tikz/data visualization/#1}\tikz@temp
        \expandafter\tikzdatavisualizationset\expandafter{\tikz@temp}
        \pgfkeysgetvalue{/tikz/data visualization/\pgfkeysvalueof{/tikz/data visualization/direction axis}/scaling mapper}\pgf@dv@tick@dir@mapper
        % Ok, now it's time to draw the ticks!
        \foreach \tikz@dv@tick@pos in \tikz@dv@at@list 
        {
          \ifx\tikz@dv@tick@pos\pgfutil@empty
          \else
            \expandafter\tikz@lib@dv@parse\tikz@dv@tick@pos\pgf@stop%
            \expandafter\tikzdatavisualizationset\expandafter{\tikz@lib@dv@tick@opt}%
            \tikz@lib@dv@mapper.set in to(\tikz@dv@tick@pos)%
            % First, compute position of tick:
            \pgf@process{\pgfpointdvlocaldatapoint}
            \xdef\pgf@dv@tick@origin{\noexpand\pgfqpoint{\the\pgf@x}{\the\pgf@y}}
            % Ok, calculate direction vector:
            \tikzpointandanchordirection{\pgf@dv@tick@dir@mapper.set in to(min)}{\pgf@dv@tick@dir@mapper.set in to(max)}
            \xdef\pgf@dv@tick@dir{\noexpand\pgfqpoint{\the\pgf@x}{\the\pgf@y}}
            % Now, show something:
            \pgf@process{\pgfpointadd{\pgf@dv@tick@origin}{\pgfpointscale{\pgfkeysvalueof{/tikz/data visualization/max extend}}{\pgf@dv@tick@dir}}}
            \xdef\tikz@dv@max@tick{\the\pgf@x,\the\pgf@y}
            \pgf@process{\pgfpointadd{\pgf@dv@tick@origin}{\pgfpointscale{\pgfkeysvalueof{/tikz/data visualization/min extend}}{\pgf@dv@tick@dir}}}
            \xdef\tikz@dv@min@tick{\the\pgf@x,\the\pgf@y}
            \draw[/tikz/data visualization/styling]
                 (\tikz@dv@min@tick) \iftikz@dv@min@tick@node \tikz@dv@handle@tick{\tikz@dv@min@anchor} \fi
              -- (\tikz@dv@max@tick) \iftikz@dv@max@tick@node \tikz@dv@handle@tick{\tikz@dv@max@anchor} \fi;
          \fi      
        }
      \endscope
    }
  \fi
}

\def\tikz@lib@dv@parse#1\pgf@stop{%
  \pgfutil@in@{as}{#1}%
  \ifpgfutil@in@%
    \tikz@lib@dv@parse@as#1\pgf@stop% 
  \else%
    \tikz@lib@dv@parse@as#1as\tikz@lib@dv@typeset\pgf@stop%
  \fi%
}
\def\tikz@lib@dv@parse@as#1as{%
  \def\tikz@dv@tick@pos{#1}%
  \pgfutil@ifnextchar[{\tikz@lib@dv@parse@as@opt}{\tikz@lib@dv@parse@as@opt[]}%]
}
\def\tikz@lib@dv@parse@as@opt[#1]{%
  \def\tikz@lib@dv@tick@opt{#1}%
  \pgfutil@ifnextchar\pgf@stop{\tikz@lib@dv@parse@as@text\tikz@lib@dv@typeset}{\tikz@lib@dv@parse@as@text}
}
\def\tikz@lib@dv@parse@as@text#1\pgf@stop{%
  \def\tikz@lib@dv@tick@text{#1}%
}

\def\tikz@lib@dv@typeset{\pgfkeysvalueof{/tikz/data visualization/typesetter}{\tikz@dv@tick@pos}}

\newif\iftikz@dv@min@tick@node
\newif\iftikz@dv@max@tick@node

\def\tikz@dv@handle@tick#1{%
  \pgfextra{
    \ifx\tikz@lib@dv@tick@text\pgfutil@empty%
      \global\let\tikz@dv@tick@marshal=\pgfutil@empty% Skip!
    \else
      \def\tikz@dv@tick@marshal{node[anchor=#1,/tikz/data visualization/node styling]}%
      \expandafter\pgfutil@g@addto@macro\expandafter\tikz@dv@tick@marshal\expandafter{\expandafter{\tikz@lib@dv@tick@text}}
    \fi
  \expandafter}%
  \tikz@dv@tick@marshal
}       


% Help function
\def\tikzpointandanchordirection#1#2{%
  % This function works like pgfpointdvdirection, but also computes
  % appriate "min" and "max" anchors.
  \pgf@process{\pgfpointdvdirection{#1}{#2}}
  {
    \pgf@ya=\pgf@y
    \pgf@y=-\pgf@x
    \pgf@x=\pgf@ya
    \tikz@auto@anchor
    \xdef\tikz@dv@max@anchor{\tikz@anchor}
    \tikz@auto@anchor@prime
    \xdef\tikz@dv@min@anchor{\tikz@anchor}
  }
}




% Grid visualization 
%
% #1 = name of axis on which grid lines should be shown
% #2 = options for the visualization

\def\tikz@lib@dv@gv#1#2{
  \tikzdatavisualizationset{
    major grid actions/.append={\tikz@lib@dv@show@grid{major}{#1}{#2}},
    minor grid actions/.append={\tikz@lib@dv@show@grid{minor}{#1}{#2}},
    subminor grid actions/.append={\tikz@lib@dv@show@grid{subminor}{#1}{#2}},
  }
}

\def\tikz@lib@dv@show@grid#1#2#3{%
  % First, check whether there is anything to do at all:
  \pgfkeysgetvalue{#2/grid at}\tikz@lib@dv@settings%
  \ifx\tikz@lib@dv@settings\pgfutil@empty%
    % Great, nothing to do
  \else
    {%
      \let\tikz@dv@at@list\pgfutil@empty
      \scope[/tikz/data visualization/.cd,every #1 grid/.try,grid styling,grid styling/.style=,#3]
        % Setup options
        \pgfkeysgetvalue{#2/scaling mapper}\tikz@lib@dv@mapper
        \expandafter\tikzdatavisualizationset\expandafter{\tikz@lib@dv@settings}%
        \pgfkeysgetvalue{/tikz/data visualization/common}\tikz@temp
        \expandafter\tikzdatavisualizationset\expandafter{\tikz@temp}
        \pgfkeysgetvalue{/tikz/data visualization/#1}\tikz@temp
        \expandafter\tikzdatavisualizationset\expandafter{\tikz@temp}
        \pgfkeysgetvalue{/tikz/data visualization/\pgfkeysvalueof{/tikz/data visualization/direction axis}/scaling mapper}\pgf@dv@grid@dir@mapper
        % Ok, now it's time to draw the grid!
        \foreach \tikz@dv@grid@pos in \tikz@dv@at@list 
        {
          \ifx\tikz@dv@grid@pos\pgfutil@empty
          \else
            \expandafter\tikz@lib@dv@parse\tikz@dv@grid@pos\pgf@stop%
            \expandafter\tikzdatavisualizationset\expandafter{\tikz@lib@dv@tick@opt}%
            \tikzdatavisualizationset{grid styling}%
            \tikz@lib@dv@mapper.set in to(\tikz@dv@tick@pos)%
            \draw[/tikz/data visualization/styling]
              \pgfextra{
                % First, compute start of grid:
                \pgf@dv@grid@dir@mapper.set in to(\pgfkeysvalueof{/tikz/data visualization/min extend})%
                \pgfpathdvmoveto%
                \pgf@dv@grid@dir@mapper.set in to(\pgfkeysvalueof{/tikz/data visualization/max extend})%
                \pgfpathdvlineto%
              };
          \fi
        }
      \endscope
    }
  \fi
}


% 
% Label visualization 
%

\def\tikz@lib@dv@lv#1#2{
  \tikzdatavisualizationset{
    label actions/.append={\tikz@lib@dv@show@label{#1}{#2}}
  }
}

\def\tikz@lib@dv@show@label#1#2{%
  % First, check whether there is anything to do at all:
  \pgfkeysgetvalue{#1/label}\tikz@dv@lib@label%
  \ifx\tikz@dv@lib@label\pgfutil@empty%
    % Great, nothing to do
  \else
    \scope[/tikz/data visualization/.cd,every label/.try,#2]
      \pgfkeysgetvalue{/tikz/data visualization/value}\tikz@lib@dv@at%
      \pgfkeysgetvalue{/tikz/data visualization/pos}\tikz@lib@dv@pos%
      \pgfkeysgetvalue{#1/scaling mapper}\tikz@dv@mapper
      \ifx\tikz@lib@dv@pos\pgfutil@empty%
        \ifx\tikz@lib@dv@at\pgfutil@empty%
          % Well, hopefully the node options setup things correctly...
        \else%
          \tikz@dv@mapper.set in to(\tikz@lib@dv@at)%
          \pgftransformshift{\pgfpointdvlocaldatapoint}
          % Special treatment of "min" and "max"
          \ifx\tikz@lib@dv@at\pgf@min@text%
            % Ok, calculate direction vector:
            \tikzpointandanchordirection{\tikz@dv@mapper.set in to(min)}{\tikz@dv@mapper.set in to(max)}
            \xdef\tikz@dv@dir{\noexpand\pgfqpoint{\the\pgf@x}{\the\pgf@y}}
            \pgftransformshift{\pgfpointscale{\pgfkeysvalueof{#1/min extend}}{\tikz@dv@dir}}
            \tikzset{anchor=\tikz@dv@min@anchor}
          \else%
            \ifx\tikz@lib@dv@at\pgf@max@text%
              % Ok, calculate direction vector:
              \tikzpointandanchordirection{\tikz@dv@mapper.set in to(min)}{\tikz@dv@mapper.set in to(max)}
              \xdef\tikz@dv@dir{\noexpand\pgfqpoint{\the\pgf@x}{\the\pgf@y}}
              \pgftransformshift{\pgfpointscale{\pgfkeysvalueof{#1/max extend}}{\tikz@dv@dir}}
              \tikzset{anchor=\tikz@dv@max@anchor}
            \fi%
          \fi%
        \fi%
      \else%
        \tikz@dv@mapper.set in to(min)%
        \pgftransformshift{\pgfpointscale{1-\tikz@lib@dv@pos}{\pgfpointdvlocaldatapoint}}
        \tikz@dv@mapper.set in to(max)%
        \pgftransformshift{\pgfpointscale{\tikz@lib@dv@pos}{\pgfpointdvlocaldatapoint}}
      \fi
      \expandafter\tikz@lib@dv@parse@node\tikz@dv@lib@label\pgf@stop
    \endscope
  \fi
}

\def\tikz@lib@dv@parse@node{\pgfutil@ifnextchar[\tikz@lib@dv@parse@node@opt{\tikz@lib@dv@parse@node@opt[]}}%}
\def\tikz@lib@dv@parse@node@opt[#1]#2\pgf@stop{
  \node [/tikz/data visualization/node styling,#1] {#2};
}



%
% Tick placement strategies
%

\tikzdatavisualizationset{
  step/.initial=1,
  phase/.initial=0,
  typesetter/.initial=\pgfmathprintnumber,
  linear/.code=\tikz@lib@dv@linear
}

\def\tikz@lib@dv@linear{%
  \tikz@lib@dv@mapper.get in range interval()%
  \pgfdvinrangeinterval.get min and max()%
  % Compute start:
  \pgfmathsetmacro\tikz@temp{\pgfdvmin-\pgfkeysvalueof{/tikz/data visualization/phase}}
  \pgfmathsetmacro\tikz@temp{\tikz@temp/\pgfkeysvalueof{/tikz/data visualization/step}}
  \pgfmathsetmacro\tikz@temp{floor(\tikz@temp)}
  \pgfmathsetmacro\tikz@lib@dv@current{\tikz@temp*\pgfkeysvalueof{/tikz/data visualization/step}+\pgfkeysvalueof{/tikz/data visualization/phase}}
  \let\tikz@lib@dv@ats\pgfutil@empty%
  \pgfmathsetmacro\tikz@lib@dv@epsilon{0.01*\pgfdvmax-0.01*\pgfdvmin}
  \loop%
    \pgfmathlessthan{\tikz@lib@dv@current}{\pgfdvmin-\tikz@lib@dv@epsilon}
    \ifdim\pgfmathresult pt=1pt\relax
    \else
      \edef\tikz@lib@dv@ats{\tikz@lib@dv@ats,\tikz@lib@dv@current}
    \fi
    \pgfmathsetmacro\tikz@lib@dv@current{\tikz@lib@dv@current+\pgfkeysvalueof{/tikz/data visualization/step}}%
    \pgfmathlessthan{\tikz@lib@dv@current}{\pgfdvmax+\tikz@lib@dv@epsilon}
  \ifdim\pgfmathresult pt=1pt\relax
  \repeat%    
  \tikzdatavisualizationset{major/.expanded={at={\tikz@lib@dv@ats}}}%
}


%
% Ticks about settings
% 

\tikzdatavisualizationset{
  about/.code=\tikz@lib@dv@about{#1},
  about strategy/.initial={1.5pt/1.0pt,2.3pt/2.0pt,4pt/2.5pt,7pt/5pt,11pt/10pt},
  few/.style={about=3},
  some/.style={about=5},
  many/.style={about=10}
}

\def\tikz@lib@dv@about#1{%
  \tikz@lib@dv@mapper.get in range interval()%
  \pgfdvinrangeinterval.get min and max()%
  \pgfmathparse{\pgfdvmax-\pgfdvmin}
  \pgfmathdivide{\pgfmathresult}{#1}
  \pgfmathfloatparsenumber{\pgfmathresult}
  % Make mantisse sensible
  \pgfmathfloattomacro{\pgfmathresult}{\tikz@lib@dv@flags}{\tikz@lib@dv@mant}{\tikz@lib@dv@exp}
  \pgf@xc=\tikz@lib@dv@mant pt%
  \pgfkeysgetvalue{/tikz/data visualization/about strategy}\tikz@lib@dv@strat
  \foreach \tikz@lib@dv@threshold/\tikz@lib@replace in \tikz@lib@dv@strat
  {
    \ifdim\pgf@xc<\tikz@lib@dv@threshold%
      \global\pgf@xc=\tikz@lib@replace%
      \breakforeach
    \fi
  }
  \ifdim\pgf@xc<10pt%
    \pgfmathfloatcreate{\tikz@lib@dv@flags}{\pgf@sys@tonumber{\pgf@xc}}{\tikz@lib@dv@exp}
  \else
    \pgfmathsetmacro\tikz@lib@dv@exp{\tikz@lib@dv@exp+1}
    \divide\pgf@xc by 10\relax  
    \pgfmathfloatcreate{\tikz@lib@dv@flags}{\pgf@sys@tonumber{\pgf@xc}}{\tikz@lib@dv@exp}
  \fi
  \pgfmathfloattofixed{\pgfmathresult}
   \pgfkeyslet{/tikz/data visualization/step}\pgfmathresult
}



%
% Cartesian axes
%

\tikzdatavisualizationset{%
  new Cartesian axis/.style={
    new axis={#1},
    new object={
      class=linear transformer,
      store=/tikz/data visualization/#1/linear transformer,
      arg1/.expanded=\pgfkeysvalueof{/tikz/data visualization/#1/attribute}/scaled,
      arg2 from key=/tikz/data visualization/#1/unit vector,
    },
    #1/scaling/default/.initial=0 at 0 and 1 at 1cm,
    #1/unit vector/.initial=,
  }
}

\tikzset{
  /tikz/data visualization/axis options/.cd,
  unit vector/.code=\tikz@scan@one@point\tikz@lib@dv@uv#1,
  length/.style={\tikz@dv@axis/scaling=min at 0 and max at #1},
  positive length/.style={\tikz@dv@axis/scaling=0 at 0 and max at #1},
  negative length/.style={\tikz@dv@axis/scaling=min at -#1 and 0 at 0},
  unit length/.style={\tikz@dv@axis/scaling=0 at 0 and 1 at #1},
  power unit length/.style={\tikz@dv@axis/scaling=1 at 0 and 10 at #1}
}

\def\tikz@lib@dv@uv#1{%
  \pgfkeyssetvalue{\tikz@dv@axis/unit vector}{#1}
}



%
%
% Basic axis systems
%
%

\tikzdatavisualizationset{
  xy Cartesian/.style={
    new Cartesian axis=x axis,
    x axis={attribute=x,unit vector={(1pt,0cm)}},
    new Cartesian axis=y axis,
    y axis={attribute=y,unit vector={(0cm,1pt)}}
  },
  xy axes/.style={x axis={#1},y axis={#1}},
  uv Cartesian/.style={
    new Cartesian axis=u axis,
    u axis={attribute=u,unit vector={(1pt,0cm)}},
    new Cartesian axis=v axis,
    v axis={attribute=v,unit vector={(0cm,1pt)}}
  },
  uv axes/.style={u axis={#1},v axis={#1}},
}

\tikzdatavisualizationset{
  xyz Cartesian/.style={
    xy Cartesian,
    new Cartesian axis=z axis,
    z axis={attribute=z,unit vector={(-0.385pt,-0.385pt)}}
  },
  xyz axes/.style={x axis={#1},y axis={#1},z axis={#1}},
  uvw Cartesian/.style={
    uv Cartesian,
    new Cartesian axis=w axis,
    w axis={attribute=w,unit vector={(-0.385pt,-0.385pt)}}
  }
  uvw axes/.style={u axis={#1},v axis={#1},w axis={#1}},
}


%
% Basic plot visualizers
%

\tikzdatavisualizationset{
  new line plot/.style={
    new object={
      when=after survey,
      store=/tikz/data visualization/plot handler visualizer,
      class=plot handler visualizer,
      arg1=\tikz@plot@handler,
      arg2=#1
    },
    /data point/#1/.initial=line plot,
    /data point/#1/use path/.initial=\pgfusepath{stroke},
    /pgf/data/#1/label/.code=\pgfkeysalso{/data point/#1=##1},
    /pgf/data/#1/style/.code=\pgfkeysalso{/data point/#1/use path={\path[draw,every line plot/.try,##1];}},
  },
  new line plot/.default=line plot,
  line plot/.style=new line plot
}

\tikzdatavisualizationset{
  new rectangles/.style={
    new object={
      store=/tikz/data visualization/rectangle visualizer,
      class=rectangle visualizer,
      arg1 from key=/tikz/data visualization/#1/attribute 1,
      arg2 from key=/tikz/data visualization/#1/attribute 2,
      arg3=#1/use path
    },
    #1/attribute 1/.initial=x,
    #1/attribute 2/.initial=y,
    /data point/#1/use path/.initial=\pgfusepath{stroke},
    /data point/#1/style/.code=\pgfkeysalso{/data point/#1/use path={\path[every rectangles/.try,##1];}}
  },
  new rectangles/.default=rectangles
}




%
% Basic plots
%


% The school book axes
%
% This coordinate system can be used to create plots that look like
% plots in a typical school book: There are two axes called "x axis"
% and "y axis" that meet at the origin, there are arrows at the ends
% of the axes, pointing in the directions of the positive axes. No
% scaling is done by default, rather one unit equals one 1cm. This
% ensures that the even when multiple plots are created, the same
% scaling will be used each time.
% 
% To change the scaling, say "all axes={unit length=1mm}" for
% instance. 

\tikzdatavisualizationset{
  school book axes/.style={
    xy Cartesian,
    x axis={
      visualize axis={y axis={goto=0},style=->},
      visualize ticks={common={y axis={goto=0},direction axis=y axis},major={tick text at min extend}},
      visualize grid={common={direction axis=y axis}},
      ticks={linear},
      min extend=-.666em,
      max extend=.666em,
      visualize label=visualize x axis label
    },
    y axis={
      visualize axis={x axis={goto=0},style=->},
      visualize ticks={common={x axis={goto=0},direction axis=x axis},major={tick text at min extend}},
      visualize grid={common={direction axis=x axis}},
      ticks={linear},
      min extend=-.666em,
      max extend=.666em,
      visualize label=visualize y axis label
    },
    school book axes standard labels,
    every school book axes/.try
  }  
}


% Possible axis positionings:

\tikzdatavisualizationset{
  %
  % Place labels at the ends of the axes
  school book axes standard labels/.style={
    visualize x axis label/.style={
      value=max,
      y axis={goto=0}
    },
    visualize y axis label/.style={
      value=max,
      x axis={goto=0}
    }
  }
}


% The scientific axes
%
% The scientific axes is a 2d plot that has a predetermined width and
% height. The data is then scaled in such a way that it fits inside
% this given rectangle. 

\tikzdatavisualizationset{
  scientific axes/width/.initial=5cm,
  scientific axes/height/.initial=0.618*\pgfkeysvalueof{/tikz/data visualization/scientific axes/width},% golden ratio...
  scientific axes/.style={
    xy Cartesian,
    every axis/.append style={style={thin,draw=black!50}},
    every ticks/.append style={style={thin,draw=black!50}},
    x axis={
      length=\pgfkeysvalueof{/tikz/data visualization/scientific axes/width},
      ticks={linear},
      visualize ticks={common={y axis={goto=min},direction axis=y axis,min extend=0pt},major={tick text at min extend}},
      visualize ticks={common={y axis={goto=max},direction axis=y axis,max extend=0pt}},
      visualize axis={y axis={goto=min}},
      visualize axis={y axis={goto=max}},
      visualize grid={common={direction axis=y axis}},
      visualize label=visualize x axis label
    },
    y axis={
      length=\pgfkeysvalueof{/tikz/data visualization/scientific axes/height},
      ticks={linear},
      visualize ticks={common={x axis={goto=min},direction axis=x axis,min extend=0pt},major={tick text at min extend}},
      visualize ticks={common={x axis={goto=max},direction axis=x axis,max extend=0pt}},
      visualize axis={x axis={goto=min}},
      visualize axis={x axis={goto=max}},
      visualize grid={common={direction axis=x axis}},
      visualize label=visualize y axis label
    },
    scientific axes standard labels,
    every scientific axes/.try
  },
}



% Possible axis positionings:

\tikzdatavisualizationset{
  % 
  % Place axes labels below and left, where left label is rotated 
  %
  scientific axes standard labels/.style={
    visualize x axis label/.style={
      % Horizontal position is middle of axis:
      pos=0.5,
      y axis={goto=min},
      % Vertical position comes from bounding box:
      node style={
        at={(0,0 |- data visualization bounding box.south)},
        below
      }
    },
    visualize y axis label/.style={%
      % Vertical position is middle of axis:
      pos=0.5,
      x axis={goto=min},
      % Horizontal position comes from bounding box:
      node style={
        at={(0,0 -| data visualization bounding box.west)},
        rotate=90,
        above}
    }
  },
  % 
  % Place axes labels below and left, no rotation
  %
  scientific axes upright labels/.style={
    scientific axes standard labels,
    visualize y axis label/.style={%
      % Vertical position is middle of axis:
      pos=0.5,
      x axis={goto=min},
      % Horizontal position comes from bounding box:
      node style={
        at={(0,0 -| data visualization bounding box.west)},
        left
      }
    }    
  },
  % 
  % Place axes at the ends of the axes
  %
  scientific axes end labels/.style={
    visualize x axis label/.style={
      value=max,
      y axis={goto=min},
      % Vertical position comes from bounding box:
      node style={
        at={(0,0 -| data visualization bounding box.east)},
        right
      }
    },
    visualize y axis label/.style={
      value=max,
      x axis={goto=min},
      % Horizontal position comes from bounding box:
      node style={
        at={(0,0 |- data visualization bounding box.north)},
        above
      }
    }
  }
}



% 
% Shorthands 
%

\tikzdatavisualizationset{
  school book plot/.style={school book axes,line plot},
  scientific plot/.style={scientific axes,line plot},
}


\endinput

