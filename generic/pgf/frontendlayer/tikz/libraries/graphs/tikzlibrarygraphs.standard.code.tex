% Copyright 2010 by Till Tantau
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Public License.
%
% See the file doc/generic/pgf/licenses/LICENSE for more details.

\ProvidesFileRCS[v\pgfversion] $Header$


\usetikzlibrary{calc}


%
% Basic settings
%



%
% Basic graphs
%


% I_n
%
% An independent set with n nodes.

\tikzdefgraph{I_n}
{
  \foreach \tikz@lib@graph@node@num in {1,...,\tikz@lib@graph@node@n}
    { \tikz@lib@graph@node@num }
}



% K_n
%
% A clique with n nodes.

\tikzdefgraph{K_n}
{
  [connect as=clique]
  I_n
}


% K_nm
%
% A complete bipartite graph with n and m nodes.

\tikzdefgraph{K_nm}
{
  I_n [name=shore n] -- [join=bipartite]
  I_n [n=\tikz@lib@graph@node@m, name=shore m]
}


% C_n
%
% A cycle with n nodes.

\tikzdefgraph{C_n}
{
  [connect as=cycle]
  I_n
}


% P_n
%
% A path with n nodes.

\tikzdefgraph{P_n}
{
  [connect as=path]
  I_n
}






% 
% The butterfly connector 
%

\tikzset{
  connectors/butterfly/.code={
    {}{%
      \pgfkeys{/tikz/connectors/butterfly/.cd,#1}%
      \ifnum\pgfkeysvalueof{/tikz/connectors/butterfly/level}=0\relax%
        \pgfkeysalso{/tikz/connectors/match={\pgfkeysvalueof{/tikz/connectors/butterfly/from}}{\pgfkeysvalueof{/tikz/connectors/butterfly/to}}}%
      \else%
        {%
          \tikzlibgraphpreparecolor{\pgfkeysvalueof{/tikz/connectors/butterfly/from}}\c@pgf@counta{tikz@lg}
          \c@pgf@countb=0\relax%
          \tikzlibgraphforeachcolorednode{\pgfkeysvalueof{/tikz/connectors/butterfly/to}}\tikz@lib@graph@butterfly@do%
        }%
        \iftikz@butterfly@prime\else\pgfkeysalso{/tikz/connectors/match={\pgfkeysvalueof{/tikz/connectors/butterfly/from}}{\pgfkeysvalueof{/tikz/connectors/butterfly/to}}}\fi%
      \fi%
    }%
  },
  connectors/butterfly/.default=,
  connectors/butterfly/level/.initial=1,
  connectors/butterfly/from/.initial=out',
  connectors/butterfly/to/.initial=in',
  connectors/butterfly'/.code={%
    {}{\tikz@butterfly@primetrue\pgfkeysalso{butterfly={#1}}}},
  connectors/butterfly'/.default=,
}

\newif\iftikz@butterfly@prime

\def\tikz@lib@graph@butterfly@do#1{%
  \advance\c@pgf@countb by1\relax%
  % Compute other side...
  \c@pgf@countc=\pgfkeysvalueof{/tikz/connectors/butterfly/level}\relax%
  {%
    % Computer countb mod (2level)
    \count0=\c@pgf@countc\relax%
    \multiply\count0 by2\relax%
    \count1=\c@pgf@countb\relax%
    \advance\count1 by-1\relax%
    \count2=\count1\relax%
    \count3=\count1\relax%
    \divide\count1 by\count0\relax%
    \multiply\count1 by\count0\relax%
    \advance\count2 by-\count1\relax%
    % count0 = 2*level
    % count2 = countb mod (2level) (starting with 0)
    % count1 = countb - count2 (starting with 0)
    \ifnum\count2<\c@pgf@countc\relax%
      \advance\count3 by \c@pgf@countc\relax%
    \else%
      \advance\count3 by -\c@pgf@countc\relax%
    \fi%
    \expandafter%
  }%
  \expandafter\c@pgf@countc\the\count3\relax%
  \advance\c@pgf@countc by1\relax%
  \ifnum\c@pgf@countc>\c@pgf@counta\relax%
    \c@pgf@countc=\c@pgf@counta\relax%
  \fi%
  \tikz@lib@graph@default@new@edge{\csname tikz@lg\the\c@pgf@countc\endcsname}{#1}%
}


