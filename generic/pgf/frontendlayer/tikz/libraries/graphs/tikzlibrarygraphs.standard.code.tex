% Copyright 2010 by Till Tantau
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Public License.
%
% See the file doc/generic/pgf/licenses/LICENSE for more details.

\ProvidesFileRCS[v\pgfversion] $Header$


\usetikzlibrary{calc}


%
% Basic settings
%



%
% Basic graphs
%


% V_n
%
% A set of n nodes.

\tikzdefgraph{subgraph I_n}
{
  \foreach \tikz@lib@graph@node@num in {1,...,\tikz@lib@graph@node@n}
    { \tikz@lib@graph@node@num }
}


% I_n
%
% A set of n nodes.

\tikzdefgraph{induced subgraph I_n}
{
  [induced independent set]
  subgraph I_n
}



% K_n
%
% A clique with n nodes.

\tikzdefgraph{subgraph K_n}
{
  [clique]
  subgraph I_n
}



% K_nm
%
% A complete bipartite graph with n and m nodes.

\tikzdefgraph{subgraph K_nm}
{
  subgraph I_n [name=shore n] -- [bipartite]
  subgraph I_n [n=\tikz@lib@graph@node@m, name=shore m]
}



% induced K_nm
%
% Make the complete bipartite graph with n and m nodes an induced subgraph.

\tikzdefgraph{induced subgraph K_nm}
{
  induced subgraph I_n [name=shore n] -- [bipartite]
  induced subgraph I_n [n=\tikz@lib@graph@node@m, name=shore m]
}



% C_n
%
% A cycle with n nodes.

\tikzdefgraph{subgraph C_n}
{
  [cycle]
  subgraph I_n
}



% induced C_n
%
% An induced cycle with n nodes.

\tikzdefgraph{induced subgraph C_n}
{
  [induced cycle]
  subgraph I_n
}



% P_n
%
% A path with n nodes.

\tikzdefgraph{subgraph P_n}
{
  [path]
  subgraph I_n
}


% induced P_n
%
% An induced path with n nodes.

\tikzdefgraph{induced subgraph P_n}
{
  [induced path]
  subgraph I_n
}






% 
% The butterfly connector 
%

\tikzset{
  graphs/.cd,
  butterfly/.style={operator=
    {}{%
      \pgfkeys{/tikz/graphs/butterfly/.cd,#1}%
      \ifnum\pgfkeysvalueof{/tikz/graphs/butterfly/level}=0\relax%
        \tikzgraphinvokeoperator{flow={\pgfkeysvalueof{/tikz/graphs/butterfly/from}}{\pgfkeysvalueof{/tikz/graphs/butterfly/to}}}%
      \else%
        {%
          \tikzlibgraphpreparecolor{\pgfkeysvalueof{/tikz/graphs/butterfly/from}}\c@pgf@counta{tikz@lg}
          \c@pgf@countb=0\relax%
          \tikzlibgraphforeachcolorednode{\pgfkeysvalueof{/tikz/graphs/butterfly/to}}\tikz@lib@graph@butterfly@do%
        }%
        \iftikz@butterfly@prime\else\tikzgraphinvokeoperator{flow={\pgfkeysvalueof{/tikz/graphs/butterfly/from}}{\pgfkeysvalueof{/tikz/graphs/butterfly/to}}}\fi%
      \fi%
    }%
  },
  butterfly/.default=,
  butterfly/level/.initial=1,
  butterfly/from/.initial=target',
  butterfly/to/.initial=source',
  butterfly'/.style={operator={}{\tikz@butterfly@primetrue\pgfkeysalso{butterfly={#1}}}},
  butterfly'/.default=,
}

\newif\iftikz@butterfly@prime

\def\tikz@lib@graph@butterfly@do#1{%
  \advance\c@pgf@countb by1\relax%
  % Compute other side...
  \c@pgf@countc=\pgfkeysvalueof{/tikz/graphs/butterfly/level}\relax%
  {%
    % Computer countb mod (2level)
    \count0=\c@pgf@countc\relax%
    \multiply\count0 by2\relax%
    \count1=\c@pgf@countb\relax%
    \advance\count1 by-1\relax%
    \count2=\count1\relax%
    \count3=\count1\relax%
    \divide\count1 by\count0\relax%
    \multiply\count1 by\count0\relax%
    \advance\count2 by-\count1\relax%
    % count0 = 2*level
    % count2 = countb mod (2level) (starting with 0)
    % count1 = countb - count2 (starting with 0)
    \ifnum\count2<\c@pgf@countc\relax%
      \advance\count3 by \c@pgf@countc\relax%
    \else%
      \advance\count3 by -\c@pgf@countc\relax%
    \fi%
    \expandafter%
  }%
  \expandafter\c@pgf@countc\the\count3\relax%
  \advance\c@pgf@countc by1\relax%
  \ifnum\c@pgf@countc>\c@pgf@counta\relax%
    \c@pgf@countc=\c@pgf@counta\relax%
  \fi%
  \tikz@lib@graph@default@new@edge{\csname tikz@lg\the\c@pgf@countc\endcsname}{#1}%
}


