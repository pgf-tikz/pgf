\documentclass{minimal}
\input{pgf-regression-test}

\RequirePackage{tikz}

\begin{document}

\START

\def\myspecialsauce{\node{specialsauce}}
\let\UNDEFINED\undefined

\def\AssertInner{\AssertEquals\specialsauce\specialsauceINNER}
\def\AssertOuter{\AssertEquals\specialsauce\specialsauceOUTER}

\def\test{%
  \AssertOuter
  \begin{tikzpicture}
    \AssertInner
    \specialsauce;
    \node at (0,1) 
      {\AssertOuter \tikz {\AssertInner\node {\AssertOuter};} \AssertOuter};
    \tikz {\AssertInner \node {\AssertOuter};}
  \end{tikzpicture}
  \AssertOuter
}

% shortcut is \specialsauce
\BEGINTEST{shortcutlet, shortcut undefined ouside}
  \let\specialsauceINNER=\myspecialsauce
  \tikzaddtikzonlycommandshortcutlet{\specialsauce}{\myspecialsauce}

  \test
\ENDTEST

\BEGINTEST{shortcutlet, shortcut defined outside before doing shortcutlet}
  \let\specialsauceINNER=\myspecialsauce
  \def\specialsauceOUTER{outer definition}
  \let\specialsauce\specialsauceOUTER
  \tikzaddtikzonlycommandshortcutlet{\specialsauce}{\myspecialsauce}

  \test
\ENDTEST

\BEGINTEST{shortcutlet, shortcut defined outside after doing shortcutlet}
  \let\specialsauceINNER=\myspecialsauce
  \def\specialsauceOUTER{outer definition}  
  \tikzaddtikzonlycommandshortcutlet{\specialsauce}{\myspecialsauce}
  \let\specialsauce\specialsauceOUTER

  \test
\ENDTEST

\BEGINTEST{shortcutdef, shortcut undefined outside}
  \def\specialsauceINNER{\myspecialsauce}
  \tikzaddtikzonlycommandshortcutdef{\specialsauce}{\myspecialsauce}

  \test
\ENDTEST

\BEGINTEST{shortcutdef, shortcut defined outside before doing shortcutdef}
  \def\specialsauceINNER{\myspecialsauce}
  \def\specialsauceOUTER{outer definition}
  \let\specialsauce\specialsauceOUTER
  \tikzaddtikzonlycommandshortcutdef{\specialsauce}{\myspecialsauce}

  \test
\ENDTEST

\BEGINTEST{shortcutdef, shortcut defined outside after doing shortcutdef}
  \def\specialsauceINNER{\myspecialsauce}
  \def\specialsauceOUTER{outer definition}
  \tikzaddtikzonlycommandshortcutdef{\specialsauce}{\myspecialsauce}
  \let\specialsauce\specialsauceOUTER

  \test
\ENDTEST

\END
