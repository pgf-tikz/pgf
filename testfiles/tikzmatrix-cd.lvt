% Test commutative diagrams with tikz-cd.
\documentclass[tikz]{standalone}
\usepackage{tikz-cd,amsmath}
\input{regression-test}

\begin{document}
\showoutput
\START
\BEGINTEST{Matrices in commutative diagram}
\begin{tikzcd}[/tikz/commutative diagrams/diagrams={column sep=large}]
  \begin{bmatrix}
    A_{1} & B_{1} \\
    A_{2} & B_{2}
  \end{bmatrix}
  % The braces are protecting the &, without them it doesn't compile
  % as of tikz-dependency 1.1.
  \ar[r, "{\begin{pmatrix} e & f \\ g & h \end{pmatrix}}"]
  &
  \begin{bmatrix}
    C_{1} & D_{1} \\
    C_{2} & D_{2}
  \end{bmatrix}
\end{tikzcd}
\ENDTEST

\BEGINTEST{Homotopy extension}
\begin{tikzcd}[row sep=huge, column sep=large]
  0 \ar[r] & L_{1} \ar[r, "{\begin{bmatrix} 1 & 0 \end{bmatrix}}"]
  \ar[d, "g"]
  &
  \left(
    L_{1} \oplus K_{1}[1],
    \begin{bmatrix}
      \partial_{L_{1}} & 0 \\
      f_{1} & -\partial_{K_{1}}
    \end{bmatrix}
  \right)
  \ar[r, "{\begin{bmatrix} 0 \\ 1 \end{bmatrix}}"]
  \ar[d, "{\begin{bmatrix} g & 0 \\ s & h \end{bmatrix}}"]
  & K_{1}[1] \ar[r] \ar[d, "h"] & 0 \\
  0 \ar[r] & L_{2} \ar[r, "{\begin{bmatrix} 1 & 0 \end{bmatrix}}"]
  &
  \left(
    L_{2} \oplus K_{2}[1],
    \begin{bmatrix}
      \partial_{L_{2}} & 0 \\
      f_{2} & -\partial_{K_{2}}
    \end{bmatrix}
  \right)
  \ar[r, "{\begin{bmatrix} 0 \\ 1 \end{bmatrix}}"]
  & K_{2}[1] \ar[r] & 0
\end{tikzcd}
\ENDTEST
\END
\end{document}
