\documentclass{minimal}
\input{pgf-regression-test}
\RequirePackage{fp,pgf,tikz,xcolor}

\usetikzlibrary{graphs,quotes}
\usetikzlibrary{graphs}

\begin{document}

\BEGINBOXTEST{pgfmanual-en-pgfkeys-2}
\pgfkeys{/my key/.code=The value is '#1'.}
\pgfkeys{/my key=hi!}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-3}
\pgfkeys{/my key/.code 2 args=The values are '#1' and '#2'.}
\pgfkeys{/my key={a1}{a2}}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-4}
\pgfkeys{/my key/.code=(#1)}
\pgfkeys{/my key/.default=hello}
\pgfkeys{/my key=hallo,/my key}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-7}
\pgfkeys{/a/.code=(a:#1)}
\pgfkeys{/b/.code=(b:#1)}
\pgfkeys{/my style/.style={/a=foo,/b=bar,/a=#1}}
\pgfkeys{/my style=wow}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-9}
\pgfkeyssetvalue{/my family/my key}{Hello, world!}
\pgfkeysvalueof{/my family/my key}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-10}
\def\helloworld{Hello, world!}
\pgfkeyslet{/my family/my key}{\helloworld}
\pgfkeysvalueof{/my family/my key}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-11}
\pgfkeyssetvalue{/my family/my key}{Hello, world!}
\pgfkeysgetvalue{/my family/my key}{\helloworld}
\helloworld
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-12}
\pgfkeyssetvalue{/my family/my key}{Hello, world!}
\pgfkeysvalueof{/my family/my key}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-13}
\pgfkeyssetvalue{/my family/my key}{Hello, world!}
\pgfkeysifdefined{/my family/my key}{yes}{no}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-16}
\tikz \graph { a ->["1" red] b ->["0"] c };
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-17}
\tikz \graph { a ->[edge node={node[red,auto]{1}}] b ->[edge label=0] c };
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-18}
\let\mycharacter="
\meaning\mycharacter
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-19}
\pgfkeys{
  /handlers/first char syntax=true,
  /handlers/first char syntax/the character "/.initial=\myquotemacro,
  /handlers/first char syntax/the character </.initial=\mypointedmacro,
}

\def\myquotemacro#1{Quoted: #1. }
\def\mypointedmacro#1{Pointed: #1. }

\ttfamily \pgfkeys{"foo", <bar>}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-20}
\pgfkeys{
  /handlers/first char syntax=true,
  /handlers/first char syntax/the character '/.initial=\mysinglequotemacro
}

\def\mysinglequotemacro#1{\pgfkeysalso{label={#1}}}

\tikz \node [circle, 'foo', draw] {bar};
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-21}
\pgfkeys{
  /handlers/first char syntax=true,
  /handlers/first char syntax/the character (/.initial=\myparamacro
}

\def\myparamacro#1{\myparaparser#1\someendtext}
\def\myparaparser(#1)#2\someendtext{
  \pgfmathparse{#1}
  \ifx\pgfmathresult\onetext
    \pgfkeysalso{#2}
  \fi
}
\def\onetext{1}

\foreach \i in {1,...,4}
  \tikz \node [draw, thick, rectangle, (pi>\i) circle, (pi>\i*2) draw=red] {x};
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-22}
\def\mystore#1+#2\pgfeov{\def\a{#1}\def\b{#2}}
\pgfkeyslet{/my key/.@cmd}{\mystore}
\pgfkeys{/my key=hello+world}

|\a| is \a, |\b| is \b.
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-23}
\pgfkeysdef{/my key}{#1, #1.}
\pgfkeys{/my key=hello}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-24}
\pgfkeysdefnargs{/my key}{2}{\def\a{#1}\def\b{#2}}
\pgfkeys{/my key=
    {hello}
    {world}}

|\a| is `\a', |\b| is `\b'.
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-25}
\pgfkeysdefargs{/my key}{#1+#2}{\def\a{#1}\def\b{#2}}
\pgfkeys{/my key=hello+world}

|\a| is \a, |\b| is \b.
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-27}
\pgfkeysdef{/handlers/.my code}{\pgfkeysdef{\pgfkeyscurrentpath}{#1}}
\pgfkeys{/my key/.my code=(#1)}
\pgfkeys{/my key=hallo}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-28}
\pgfkeys{/the/key/.code={Initial definition. }}
\pgfkeys{/handlers/.unknown/.code={Unknown key `\pgfkeyscurrentkey'. }}

\pgfkeys{/the/key}

\pgfkeys{/handler config=only existing}

\pgfkeys{/the/key/.code={Re-Definition. }}
\pgfkeys{/the/key}

\pgfkeys{/the/other key/.code={New definition. }}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-31}
\pgfkeys{/my search path/.unknown/.code=
  {%
    \let\searchname=\pgfkeyscurrentname%
    \pgfkeysalso{%
      /a/\searchname/.try=#1,
      /b/\searchname/.retry=#1,
      /b/c/\searchname/.retry=#1%
    }%
  }%
}

\pgfkeys{/b/custom/.code={This is `\pgfkeyscurrentkey'. }}

\pgfkeys{/handler config=only existing}

\pgfkeys{/my search path/.cd,custom}

\pgfkeys{/my search path/.cd,custom/.append code={Modified. }}

\pgfkeys{/my search path/.cd,custom}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-36}
\pgfkeys{/a key/.code n args={2}{First=`#1', Second=`#2'}}
\pgfkeys{/a key={A}{B}}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-40}
\begin{tikzpicture}[outline/.style={draw=#1,fill=#1!20}]
  \node [outline=red]            {red box};
  \node [outline=blue] at (0,-1) {blue box};
\end{tikzpicture}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-44}
\pgfkeys{/my key/.initial=red}
\pgfkeys{/my key/.code=#1}
\pgfkeys{/my key=blue}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-45}
\pgfkeys{/my key/.initial=red}
\pgfkeys{/my key=blue}
\pgfkeys{/my key/.get=\mymacro}
\mymacro
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-46}
\pgfkeys{/text/.store in=\mytext}
\def\a{world}
\pgfkeys{/text=Hello \a!}
\def\a{Gruffalo}
\mytext
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-47}
\pgfkeys{/text/.estore in=\mytext}
\def\a{world}
\pgfkeys{/text=Hello \a!}
\def\a{Gruffalo}
\mytext
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-48}
\newif\iftheworldisflat
\pgfkeys{/flat world/.is if=theworldisflat}
\pgfkeys{/flat world=false}
\iftheworldisflat
  Flat
\else
  Round?
\fi
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-50}
\def\a{bottom}
\def\b{\a}
\def\c{\b}

\pgfkeys{/key1/.initial=\c}
\pgfkeys{/key2/.initial/.expand once=\c}
\pgfkeys{/key3/.initial/.expand twice=\c}
\pgfkeys{/key4/.initial/.expanded=\c}

\def\a{{\ttfamily\string\a}}
\def\b{{\ttfamily\string\b}}
\def\c{{\ttfamily\string\c}}

\begin{tabular}{ll}
Key 1:& \pgfkeys{/key1} \\
Key 2:& \pgfkeys{/key2} \\
Key 3:& \pgfkeys{/key3} \\
Key 4:& \pgfkeys{/key4}
\end{tabular}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-51}
\pgfkeys{
  /golden ratio/.initial/.evaluated={(1 + sqrt(5))/2},
}
\pgfkeys{/golden ratio}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-52}
\pgfkeys{/foo/.code=(#1)}
\pgfkeys{/foo/.list={a,b,0,1,...,5}}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-53}
\pgfkeys{
  /a/.code=(a:#1),
  /b/.code=(b:#1),
  /b/.forward to=/a,
  /c/.forward to=/a
}
\pgfkeys{/b=1} \pgfkeys{/c=2}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-54}
\pgfkeys{/secondary path/option/.code={Invoking /secondary path/option with `#1'}}

\pgfkeys{/main path/.search also={/secondary path}}

\pgfkeys{/main path/.cd,option=value}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-55}
\pgfkeys{/secondary path/option/.code={Invoking /secondary path/option with `#1'}}

\pgfkeys{/main path/.search also={/secondary path}}

\pgfkeys{/main path/.cd,option=value}

\pgfkeys{/handlers/.unknown/.code={Found unknown option \pgfkeyscurrentkeyRAW={#1}!}}%
\pgfkeys{/main path/.cd,/main path/option=value}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-59}
\pgfkeys{/a/.code=(a:#1)}
\pgfkeys{/b/.code=(b:#1)}
\pgfkeys{/x/.try=hmm,/a/.try=hallo,/b/.try=welt}
\ENDBOXTEST

\BEGINBOXTEST{pgfmanual-en-pgfkeys-60}
\pgfkeys{/a/.code=(a:#1)}
\pgfkeys{/b/.code=(b:#1)}
\pgfkeys{/x/.try=hmm,/a/.retry=hallo,/b/.retry=welt}
\ENDBOXTEST
\END
